{"remainingRequest":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/account/Profile.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/account/Profile.vue","mtime":1608329558650},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCAqIGFzIHVzZXIgZnJvbSAnQC9hcGlfY2FsbHMvVXNlci5qcycKaW1wb3J0ICogYXMgbWliYW5kX2Nvbm4gZnJvbSAnQC9hcGlfY2FsbHMvTWliYW5kQ29ubmVjdGlvbi5qcycKaW1wb3J0IERldmljZU1hbmFnZW1lbnQgZnJvbSAnQC9jb21wb25lbnRzL0RldmljZU1hbmFnZW1lbnQnCmltcG9ydCBDaGFuZ2VQYXNzd29yZEZvcm0gZnJvbSAnQC9jb21wb25lbnRzL2FjY291bnQvQ2hhbmdlUGFzc3dvcmRGb3JtLnZ1ZScKCmV4cG9ydCBkZWZhdWx0IHsKICAgIGNvbXBvbmVudHM6IHsgCiAgICAgICAgRGV2aWNlTWFuYWdlbWVudCwKICAgICAgICBDaGFuZ2VQYXNzd29yZEZvcm0KICAgIH0sCiAgICBjcmVhdGVkKCkgewogICAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMudXNlcikKICAgICAgICB0aGlzLmdlbmVyYXRlQXZ0U3RyKCkKICAgICAgICAKICAgIH0sCiAgICBkYXRhKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHVzZXI6IHRoaXMuJHNlc3Npb24uZ2V0KCd1c2VyJyksCiAgICAgICAgICAgIGF2YXRhclN0cjogJycsCiAgICAgICAgICAgIHVwZGF0ZU5hbWVNb2RlOiBmYWxzZSwKICAgICAgICAgICAgY2hhbmdlUHdNb2RlOiBmYWxzZSwKICAgICAgICAgICAgZGVsZXRlU3RhdHVzOiAnJywKICAgICAgICAgICAgbWliYW5kX2RiX2hvc3Q6IHRoaXMuJGFwaV9ob3N0c1snbWliYW5kX2RiX2FwaSddLAogICAgICAgICAgICBtaWJhbmRfZGJfcG9ydDogdGhpcy4kYXBpX3BvcnRzWydtaWJhbmRfZGJfYXBpJ10sCiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBlbnRlclVwZGF0ZU5hbWVNb2RlKCkgewogICAgICAgICAgICB0aGlzLnVwZGF0ZU5hbWVNb2RlID0gdHJ1ZQogICAgICAgIH0sCiAgICAgICAgZXhpdFVwZGF0ZU5hbWVNb2RlKCkgewogICAgICAgICAgICB0aGlzLnVzZXIuZnVsbG5hbWU9dGhpcy4kc2Vzc2lvbi5nZXQoJ3VzZXInKS5mdWxsbmFtZQogICAgICAgICAgICB0aGlzLnVwZGF0ZU5hbWVNb2RlID0gZmFsc2UKICAgICAgICB9LAogICAgICAgIGVudGVyQ2hhbmdlUHdNb2RlKCkgewogICAgICAgICAgICB0aGlzLmNoYW5nZVB3TW9kZSA9IHRydWUKICAgICAgICB9LAogICAgICAgIGV4aXRDaGFuZ2VQd01vZGUoKSB7CiAgICAgICAgICAgIHRoaXMuY2hhbmdlUHdNb2RlID0gZmFsc2UKICAgICAgICB9LAoKICAgICAgICBnZW5lcmF0ZUF2dFN0cigpIHsKICAgICAgICAgICAgaWYodGhpcy51c2VyLmZ1bGxuYW1lIT1udWxsKSB7CiAgICAgICAgICAgICAgICB2YXIgc3RyID0gU3RyaW5nKHRoaXMuJHNlc3Npb24uZ2V0KCd1c2VyJykuZnVsbG5hbWUpCiAgICAgICAgICAgICAgICB2YXIgc2VwZXJhdGVOYW1lID0gc3RyLnNwbGl0KCIgIikKICAgICAgICAgICAgICAgIGlmKHNlcGVyYXRlTmFtZS5sZW5ndGg9PTEpewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXZhdGFyU3RyID0gc2VwZXJhdGVOYW1lWzBdWzBdCiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuYXZhdGFyU3RyPXNlcGVyYXRlTmFtZVswXVswXSArIHNlcGVyYXRlTmFtZVtzZXBlcmF0ZU5hbWUubGVuZ3RoLTFdWzBdCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgfQogICAgICAgICAgICBlbHNlewogICAgICAgICAgICAgICAgdGhpcy5hdmF0YXJTdHI9JycKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHVwZGF0ZU5hbWUoKSB7CiAgICAgICAgICAgIGNvbnN0IHVpZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCd1c2VyJykuaWQKICAgICAgICAgICAgLy8gdGhpcy51cGRhdGVOYW1lQXBpQ2FsbCh0aGlzLnVzZXIuZW1haWwsIHRoaXMudXNlci5mdWxsbmFtZSkKICAgICAgICAgICAgdXNlci51cGRhdGVOYW1lQXBpQ2FsbCh1aWQsIHRoaXMudXNlci5mdWxsbmFtZSkudGhlbigodXNlcik9PnsKICAgICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uc2V0KCd1c2VyJywgdXNlcikKICAgICAgICAgICAgICAgIHRoaXMuZ2VuZXJhdGVBdnRTdHIoKQogICAgICAgICAgICAgICAgdGhpcy5leGl0VXBkYXRlTmFtZU1vZGUoKQogICAgICAgICAgICAgICAgLy8gdGhpcy4kZm9yY2VVcGRhdGUKICAgICAgICAgICAgfSkKICAgICAgICB9LAoKICAgICAgICBhc3luYyBkZWxldGVMb2dzQXBpQ2FsbCgpIHsKICAgICAgICAgICAgY29uc3QgdXNlcl9pZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCd1c2VyJykuaWQKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly8ke3RoaXMubWliYW5kX2RiX2hvc3R9OiR7dGhpcy5taWJhbmRfZGJfcG9ydH0vdXNlcnMvJHt1c2VyX2lkfS9sb2dzYCwgewogICAgICAgICAgICAgICAgICAgIG1ldGhvZDogJ0RFTEVURScKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgIGlmKHJlc3VsdFsnZGVsZXRlLXJlc3VsdCddPT0nc3VjY2VlZGVkJykgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfQogICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKQogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgYXN5bmMgdW5wYWlyQmFuZERiQXBpQ2FsbCgpIHsKICAgICAgICAgICAgY29uc3QgYmFuZGlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoJ21pYmFuZCcpLmlkCiAgICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwOi8vJHt0aGlzLm1pYmFuZF9kYl9ob3N0fToke3RoaXMubWliYW5kX2RiX3BvcnR9L2JhbmRzLyR7YmFuZGlkfS91bnBhaXJgKQogICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpCgogICAgICAgICAgICAgICAgLy8gZG8gc29tZXRoaW5nIHdpdGggYGRhdGFgCiAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ3VucGFpci1iYW5kLXJlc3VsdCddPT0ic3VjY2VlZGVkIikKICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZQogICAgICAgICAgICAgICAgZWxzZSByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIC8vIGRvIHNvbWV0aGluZyB3aXRoIGBlcnJvcmAKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGFzeW5jIGRlbGV0ZUFuZENsb3NlTW9kYWwoKSB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJfaWQgPSB0aGlzLiRzZXNzaW9uLmdldCgndXNlcicpLmlkCgogICAgICAgICAgICB0aGlzLiRidk1vZGFsLmhpZGUoJ2NvbmZpcm0tcmVtb3ZlLW1vZGFsJykKCiAgICAgICAgICAgIHRoaXMuZGVsZXRlU3RhdHVzID0gJ1BFTkRJTkcnCiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBkZWxldGVMb2dzUmVzdWx0ID0gYXdhaXQgdGhpcy5kZWxldGVMb2dzQXBpQ2FsbCgpCiAgICAgICAgICAgIHZhciB1bnBhaXJCYW5kUmVzdWx0ID0gdHJ1ZQogICAgICAgICAgICB2YXIgZGVsZXRlVXNlclJlc3VsdAogICAgICAgICAgICBpZihkZWxldGVMb2dzUmVzdWx0KSB7IC8vaWYgc3VjY2VlZGVkCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0aGlzLiRzZXNzaW9uLmdldCgnbWliYW5kJykpCiAgICAgICAgICAgICAgICBpZih0aGlzLiRzZXNzaW9uLmdldCgnbWliYW5kJykhPXVuZGVmaW5lZCkgeyAvL2lmIHBhaXJpbmcgYmFuZCBleGlzdAogICAgICAgICAgICAgICAgICAgIGF3YWl0IG1pYmFuZF9jb25uLmRpc2Nvbm5lY3RBcGlDYWxsKCkKICAgICAgICAgICAgICAgICAgICB1bnBhaXJCYW5kUmVzdWx0ID0gYXdhaXQgdGhpcy51bnBhaXJCYW5kRGJBcGlDYWxsKCkKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZih1bnBhaXJCYW5kUmVzdWx0KSB7CiAgICAgICAgICAgICAgICBkZWxldGVVc2VyUmVzdWx0ID0gYXdhaXQgdXNlci5kZWxldGVVc2VyQXBpQ2FsbCh1c2VyX2lkKQogICAgICAgICAgICAgICAgaWYoZGVsZXRlVXNlclJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuZGVsZXRlU3RhdHVzID0gJ09LJwogICAgICAgICAgICAgICAgICAgIHRoaXMuJHNlc3Npb24uZGVzdHJveSgpCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kZW1pdCgnbG9naW4tc3RhdHVzLWNoYW5nZScpCiAgICAgICAgICAgICAgICAgICAgdGhpcy4kcm91dGVyLnB1c2goJy8nKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIH0KfQo="},{"version":3,"sources":["Profile.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0EA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Profile.vue","sourceRoot":"src/components/account","sourcesContent":["<template>\n    <div class=\"w-50 mx-auto mt-3 mb-3\" v-if=\"this.$session.exists()\">\n        <b-card>\n            <template #header>\n                <div class=\"d-flex justify-content-center\">\n                    <b-avatar :text=\"avatarStr\" size=\"6rem\"></b-avatar>\n                </div>\n                <b-card-title v-if=\"user.fullname==null&&updateNameMode!=true\" class=\"text-center mt-2\">\n                    <b-button variant=\"outline-primary\" @click=\"enterUpdateNameMode\">\n                        Please tell us your name üìù\n                    </b-button>\n                </b-card-title>\n                <b-card-title v-else-if=\"updateNameMode==true\" class=\"text-center mt-2\">\n                    <b-form @submit.prevent=\"updateName\" inline class=\"d-flex justify-content-around\">\n                        <b-form-input class=\"w-75\"\n                        v-model=\"user.fullname\"\n                        placeholder=\"Enter your name\"\n                    ></b-form-input>\n                    <div>\n                        <b-button @click=\"updateName\" variant=\"success\" class=\"mr-1\">OK</b-button>\n                        <b-button @click=\"exitUpdateNameMode\" variant=\"danger\">‚úñÔ∏è</b-button>\n                    </div>\n                    </b-form>\n                </b-card-title>\n                <b-card-title v-else class=\"text-center mt-2\">\n                    {{user.fullname}}\n                    <b-button variant=\"outline-primary\" @click=\"enterUpdateNameMode\">üìù</b-button>\n                </b-card-title>\n                <b-card-sub-title class=\"text-center\">{{user.email}}</b-card-sub-title>\n                <!-- <div class=\"d-flex justify-content-center\">\n                    <b-card-text>üèÜ Strike: 4days</b-card-text>\n                </div> -->\n            </template>\n\n            <b-skeleton-wrapper :loading=\"deleteStatus === 'PENDING'\">\n                <template #loading>\n                <b-card>\n                <b-skeleton width=\"85%\"></b-skeleton>\n                <b-skeleton width=\"55%\"></b-skeleton>\n                <b-skeleton width=\"70%\"></b-skeleton>\n                </b-card>\n            </template>\n            <device-management />\n\n            <!-- <b-card title=\"More\" class=\"mt-1\">\n                <b-button variant=\"outline-primary\" class=\"w-100\">Set goal</b-button>\n            </b-card> -->\n\n            <b-card title=\"Account\" class=\"mt-1\">\n                <b-button variant=\"outline-primary\" class=\"w-100 mb-1\"\n                    @click=\"enterChangePwMode\"\n                >Change password</b-button>\n                <ChangePasswordForm v-if=\"changePwMode==true\" @exit-change-pw-mode=\"exitChangePwMode\"/>\n                <b-button variant=\"outline-primary\" class=\"w-100\" v-b-modal.confirm-delete-modal >Delete account</b-button>\n                \n            </b-card>\n            \n            <b-modal id=\"confirm-delete-modal\" hide-footer title=\"Confirmation\">\n                <div class=\"d-block text-center\">\n                    <h4>Do you really want to delete this account?</h4>\n                </div>\n                <div class=\"d-flex justify-content-end\">\n                    <b-button class=\"mt-3 mr-3\"  @click=\"$bvModal.hide('confirm-delete-modal')\">Cancel</b-button>\n                    <b-button class=\"mt-3 mr-4\" variant=\"danger\" @click=\"deleteAndCloseModal()\">Delete</b-button>\n                </div>\n            </b-modal>\n            </b-skeleton-wrapper>\n        </b-card>\n        \n    </div>\n</template>\n\n\n<script>\nimport * as user from '@/api_calls/User.js'\nimport * as miband_conn from '@/api_calls/MibandConnection.js'\nimport DeviceManagement from '@/components/DeviceManagement'\nimport ChangePasswordForm from '@/components/account/ChangePasswordForm.vue'\n\nexport default {\n    components: { \n        DeviceManagement,\n        ChangePasswordForm\n    },\n    created() {\n        // console.log(this.user)\n        this.generateAvtStr()\n        \n    },\n    data() {\n        return {\n            user: this.$session.get('user'),\n            avatarStr: '',\n            updateNameMode: false,\n            changePwMode: false,\n            deleteStatus: '',\n            miband_db_host: this.$api_hosts['miband_db_api'],\n            miband_db_port: this.$api_ports['miband_db_api'],\n        }\n    },\n    methods: {\n        enterUpdateNameMode() {\n            this.updateNameMode = true\n        },\n        exitUpdateNameMode() {\n            this.user.fullname=this.$session.get('user').fullname\n            this.updateNameMode = false\n        },\n        enterChangePwMode() {\n            this.changePwMode = true\n        },\n        exitChangePwMode() {\n            this.changePwMode = false\n        },\n\n        generateAvtStr() {\n            if(this.user.fullname!=null) {\n                var str = String(this.$session.get('user').fullname)\n                var seperateName = str.split(\" \")\n                if(seperateName.length==1){\n                    this.avatarStr = seperateName[0][0]\n                } else {\n                    this.avatarStr=seperateName[0][0] + seperateName[seperateName.length-1][0]\n                }\n                \n            }\n            else{\n                this.avatarStr=''\n            }\n        },\n\n        updateName() {\n            const uid = this.$session.get('user').id\n            // this.updateNameApiCall(this.user.email, this.user.fullname)\n            user.updateNameApiCall(uid, this.user.fullname).then((user)=>{\n                this.$session.set('user', user)\n                this.generateAvtStr()\n                this.exitUpdateNameMode()\n                // this.$forceUpdate\n            })\n        },\n\n        async deleteLogsApiCall() {\n            const user_id = this.$session.get('user').id\n            try {\n                const response = await fetch(`http://${this.miband_db_host}:${this.miband_db_port}/users/${user_id}/logs`, {\n                    method: 'DELETE'\n                })\n                const result = await response.json()\n                if(result['delete-result']=='succeeded') {\n                    return true\n                }\n                return false\n            }\n            catch (error) {\n                console.log(error)\n            }\n        },\n\n        async unpairBandDbApiCall() {\n            const bandid = this.$session.get('miband').id\n            try {\n                const response = await fetch(`http://${this.miband_db_host}:${this.miband_db_port}/bands/${bandid}/unpair`)\n                const result = await response.json()\n\n                // do something with `data`\n                if(result['unpair-band-result']==\"succeeded\")\n                    return true\n                else return false\n            } catch (error) {\n                // do something with `error`\n            }\n        },\n\n        async deleteAndCloseModal() {\n            const user_id = this.$session.get('user').id\n\n            this.$bvModal.hide('confirm-remove-modal')\n\n            this.deleteStatus = 'PENDING'\n            \n            const deleteLogsResult = await this.deleteLogsApiCall()\n            var unpairBandResult = true\n            var deleteUserResult\n            if(deleteLogsResult) { //if succeeded\n                console.log(this.$session.get('miband'))\n                if(this.$session.get('miband')!=undefined) { //if pairing band exist\n                    await miband_conn.disconnectApiCall()\n                    unpairBandResult = await this.unpairBandDbApiCall()\n                }\n            }\n            if(unpairBandResult) {\n                deleteUserResult = await user.deleteUserApiCall(user_id)\n                if(deleteUserResult) {\n                    this.deleteStatus = 'OK'\n                    this.$session.destroy()\n                    this.$emit('login-status-change')\n                    this.$router.push('/')\n                }\n            }\n        },\n    }\n}\n</script>"]}]}