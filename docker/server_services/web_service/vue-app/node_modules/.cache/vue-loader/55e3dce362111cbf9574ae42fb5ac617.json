{"remainingRequest":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/Data.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/Data.vue","mtime":1607175226173},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBHZW5lcmFsRGF0YSBmcm9tICdAL2NvbXBvbmVudHMvZGF0YS9HZW5lcmFsRGF0YScKaW1wb3J0IEhlYXJ0UmF0ZSBmcm9tICdAL2NvbXBvbmVudHMvZGF0YS9IZWFydFJhdGUnCmltcG9ydCBTdGVwQ291bnRzIGZyb20gJ0AvY29tcG9uZW50cy9kYXRhL1N0ZXBDb3VudHMnCgpjb25zdCBtaWJhbmRfZGJfaG9zdD0nMTkyLjE2OC4xMS4xMjInCmNvbnN0IG1pYmFuZF9kYl9wb3J0PSc1MDAyJwpjb25zdCBtaWJhbmRfaG9zdD0nMTkyLjE2OC4xMS4xMjInCmNvbnN0IG1pYmFuZF9wb3J0PSc1MDAxJwoKCmV4cG9ydCBkZWZhdWx0IHsKICBjb21wb25lbnRzOiB7CiAgICBHZW5lcmFsRGF0YSwgCiAgICBIZWFydFJhdGUsCiAgICBTdGVwQ291bnRzCiAgfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbWliYW5kOiB0aGlzLiRzZXNzaW9uLmdldCgnbWliYW5kJyksCiAgICAgIGhyX2tleTogZmFsc2UsCiAgICAgIGNvbm5lY3RTdGF0dXM6ICcnLAogICAgICBnZGtleTogZmFsc2UKICAgIH0KICB9LAogIGNyZWF0ZWQoKSB7CiAgICB2YXIgbWliYW5kID0gdGhpcy5taWJhbmQKICAgIGlmKG1pYmFuZD09dW5kZWZpbmVkKSB7CiAgICAgIHRoaXMuZ2V0QmFuZEluZm8oKS50aGVuKChiYW5kaW5mbyk9PnsKICAgICAgICB0aGlzLiRzZXNzaW9uLnNldCgnbWliYW5kJywgYmFuZGluZm8pCiAgICAgICAgdGhpcy4kZm9yY2VVcGRhdGUKICAgICAgfSkKICAgIH0KICB9LAoKICBtZXRob2RzOiB7CiAgICBhc3luYyBnZXRCYW5kSW5mbygpIHsKICAgICAgY29uc3QgdXNlcmlkID0gdGhpcy4kc2Vzc2lvbi5nZXQoJ3VzZXInKS5pZAogICAgICB0cnkgewogICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cDovLyR7bWliYW5kX2RiX2hvc3R9OiR7bWliYW5kX2RiX3BvcnR9L2dldGJhbmRieXVzZXIvJHt1c2VyaWR9YCkKICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgcmV0dXJuIHJlc3VsdAogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgLy8gZG8gc29tZXRoaW5nIHdpdGggYGVycm9yYAogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIGRpc2Nvbm5lY3RBcGlDYWxsKCkgewogICAgICB0cnkgewogICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cDovLyR7bWliYW5kX2hvc3R9OiR7bWliYW5kX3BvcnR9L2Rpc2Nvbm5lY3RgKQogICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcmVzcG9uc2UuanNvbigpCiAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpCiAgICAgICAgICByZXR1cm4gcmVzdWx0CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAvLyBkbyBzb21ldGhpbmcgd2l0aCBgZXJyb3JgCiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgY29ubmVjdEFwaUNhbGwobWFjX2FkZCwgYXV0aF9rZXkpIHsKICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly8ke21pYmFuZF9ob3N0fToke21pYmFuZF9wb3J0fS9jb25uZWN0YCwgewogICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgJ21hY19hZGQnOiBtYWNfYWRkLAogICAgICAgICAgICAgICdhdXRoX2tleSc6IGF1dGhfa2V5CiAgICAgICAgICAgICAgfSksCiAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCcgfSwKICAgICAgICAgIH0pCiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCkKICAgICAgICAgIGlmKHJlc3VsdFsnY29ubmVjdC1yZXN1bHQnXT09J3N1Y2NlZWRlZCcpIHsKICAgICAgICAgICAgcmV0dXJuIHJlc3VsdFsnYmFuZC1pbmZvJ10KICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgcmV0dXJuIGZhbHNlCiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGVycm9yKQogICAgICB9CiAgICB9LAoKICAgIHJlY29ubmVjdCgpIHsKICAgICAgdmFyIG1pYmFuZCA9IHRoaXMubWliYW5kCiAgICAgIHRoaXMuZGlzY29ubmVjdEFwaUNhbGwoKS50aGVuKAogICAgICAgIHRoaXMuY29ubmVjdEFwaUNhbGwobWliYW5kLm1hY19hZGRyZXNzLCBtaWJhbmQuYXV0aF9rZXkpLnRoZW4oKHJlc3VsdCk9PnsKICAgICAgICAgIGlmKHJlc3VsdCkgewogICAgICAgICAgICB0aGlzLmNvbm5lY3RTdGF0dXM9J09LJwogICAgICAgICAgICB0aGlzLmdka2V5ID0gIXRoaXMuZ2RrZXkKICAgICAgICAgIH0KICAgICAgICAgIGVsc2UgewogICAgICAgICAgICB0aGlzLmNvbm5lY3RTdGF0dXM9J0VSUk9SJwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICkKICAgICAgdGhpcy5jb25uZWN0U3RhdHVzPSdQRU5ESU5HJwogICAgfQoKICB9Cn0K"},{"version":3,"sources":["Data.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA0BA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA","file":"Data.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div class=\"w-50 mx-auto mt-3\">\n        <b-card no-body >\n          <b-button @click=\"reconnect\" variant=\"primary\">Reconnect</b-button>\n          <div v-if=\"connectStatus === 'ERROR'\">\n            <b-alert variant=\"danger\" show>Error happened while connecting. Please try again or refresh your Bluetooth connection</b-alert>\n          </div>\n          <div v-if=\"connectStatus === 'PENDING'\">\n            <b-alert variant=\"info\" show>Connecting...</b-alert>\n          </div>\n          <b-tabs card>\n            <b-tab title=\"General Information\" active> \n              <GeneralData :key='gdkey'/>\n            </b-tab>\n            <b-tab title=\"Step Counts\">\n              <StepCounts />\n            </b-tab>\n            <b-tab title=\"Heart Rate\">\n              <HeartRate />\n            </b-tab>\n        </b-tabs>\n      </b-card>\n    </div>\n</template>\n\n<script>\nimport GeneralData from '@/components/data/GeneralData'\nimport HeartRate from '@/components/data/HeartRate'\nimport StepCounts from '@/components/data/StepCounts'\n\nconst miband_db_host='192.168.11.122'\nconst miband_db_port='5002'\nconst miband_host='192.168.11.122'\nconst miband_port='5001'\n\n\nexport default {\n  components: {\n    GeneralData, \n    HeartRate,\n    StepCounts\n  },\n  data() {\n    return {\n      miband: this.$session.get('miband'),\n      hr_key: false,\n      connectStatus: '',\n      gdkey: false\n    }\n  },\n  created() {\n    var miband = this.miband\n    if(miband==undefined) {\n      this.getBandInfo().then((bandinfo)=>{\n        this.$session.set('miband', bandinfo)\n        this.$forceUpdate\n      })\n    }\n  },\n\n  methods: {\n    async getBandInfo() {\n      const userid = this.$session.get('user').id\n      try {\n          const response = await fetch(`http://${miband_db_host}:${miband_db_port}/getbandbyuser/${userid}`)\n          const result = await response.json()\n          return result\n      } catch (error) {\n          // do something with `error`\n      }\n    },\n\n    async disconnectApiCall() {\n      try {\n          const response = await fetch(`http://${miband_host}:${miband_port}/disconnect`)\n          const result = await response.json()\n          console.log(result)\n          return result\n      } catch (error) {\n          // do something with `error`\n      }\n    },\n\n    async connectApiCall(mac_add, auth_key) {\n      try {\n          const response = await fetch(`http://${miband_host}:${miband_port}/connect`, {\n          method: 'POST',\n          body: JSON.stringify({\n              'mac_add': mac_add,\n              'auth_key': auth_key\n              }),\n          headers: { 'Content-type': 'application/json; charset=UTF-8' },\n          })\n          const result = await response.json()\n          if(result['connect-result']=='succeeded') {\n            return result['band-info']\n          }\n          else return false\n      } catch (error) {\n          console.error(error)\n      }\n    },\n\n    reconnect() {\n      var miband = this.miband\n      this.disconnectApiCall().then(\n        this.connectApiCall(miband.mac_address, miband.auth_key).then((result)=>{\n          if(result) {\n            this.connectStatus='OK'\n            this.gdkey = !this.gdkey\n          }\n          else {\n            this.connectStatus='ERROR'\n          }\n        })\n      )\n      this.connectStatus='PENDING'\n    }\n\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}