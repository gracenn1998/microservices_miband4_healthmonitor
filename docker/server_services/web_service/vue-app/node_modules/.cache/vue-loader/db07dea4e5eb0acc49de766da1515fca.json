{"remainingRequest":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/account/ChangePasswordForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/account/ChangePasswordForm.vue","mtime":1608325863766},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEoKXsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBmb3JtOiB7CiAgICAgICAgICAgICAgICBjdXJyZW50UGFzc3dvcmQ6ICcnLAogICAgICAgICAgICAgICAgbmV3UGFzc3dvcmQ6ICcnLAogICAgICAgICAgICAgICAgY29uZmlybU5ld1Bhc3N3b3JkOiAnJwogICAgICAgICAgICB9LAogICAgICAgICAgICBzdWJtaXRTdGF0dXM6ICcnLAogICAgICAgICAgICB1c2VyX2RiX2hvc3Q6IHRoaXMuJGFwaV9ob3N0c1sndXNlcl9kYl9hcGknXSwKICAgICAgICAgICAgdXNlcl9kYl9wb3J0OiB0aGlzLiRhcGlfcG9ydHNbJ3VzZXJfZGJfYXBpJ10KICAgICAgICB9CiAgICB9LAogICAgY29tcHV0ZWQ6IHsKICAgICAgICBwd1N0YXRlKCkgewogICAgICAgICAgICBpZih0aGlzLmZvcm0ubmV3UGFzc3dvcmQ9PScnKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm0ubmV3UGFzc3dvcmQubGVuZ3RoID49IDYKICAgICAgICB9LAogICAgICAgIGNmUHdTdGF0ZSgpIHsKICAgICAgICAgICAgaWYodGhpcy5mb3JtLmNvbmZpcm1OZXdQYXNzd29yZD09JycpIHsKICAgICAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuZm9ybS5jb25maXJtTmV3UGFzc3dvcmQgPT0gdGhpcy5mb3JtLm5ld1Bhc3N3b3JkCiAgICAgICAgfSwKICAgICAgICBpbnZhbGlkUHcoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmZvcm0ubmV3UGFzc3dvcmQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuICdFbnRlciBhdCBsZWFzdCA2IGNoYXJhY3RlcnMuJwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgfSwKICAgICAgICBpbnZhbGlkQ2ZQdygpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZm9ybS5jb25maXJtTmV3UGFzc3dvcmQubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgcmV0dXJuICdDb25maXJtIHBhc3N3b3JkIG5lZWQgdG8gYmUgc2FtZSBhcyBwYXNzd29yZCcKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbnVsbAogICAgICAgIH0sCiAgICB9LAoKICAgIG1ldGhvZHM6IHsKCiAgICAgICAgYXN5bmMgY2hhbmdlUGFzc3dvcmRBcGlDYWxsKGN1cnJlbnRQYXNzd29yZCwgbmV3UGFzc3dvcmQpIHsKICAgICAgICAgICAgY29uc3QgdXNlcl9pZCA9IHRoaXMuJHNlc3Npb24uZ2V0KCd1c2VyJykuaWQKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYGh0dHA6Ly8ke3RoaXMudXNlcl9kYl9ob3N0fToke3RoaXMudXNlcl9kYl9wb3J0fS91c2Vycy8ke3VzZXJfaWR9L2NoYW5nZS1wYXNzd29yZGAsIHsKICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgICdjdXJfcGFzc3dvcmQnOiBjdXJyZW50UGFzc3dvcmQsCiAgICAgICAgICAgICAgICAgICAgJ25ld19wYXNzd29yZCc6IG5ld1Bhc3N3b3JkCiAgICAgICAgICAgICAgICAgICAgfSksCiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7ICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbjsgY2hhcnNldD1VVEYtOCcgfSwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgIGlmIChyZXN1bHRbJ2NoYW5nZS1wdy1yZXN1bHQnXT09J3N1Y2NlZWRlZCcpIHsgLy9zaWduIGluIHN1Y2Nlc3NmdWxseQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpCiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBjaGFuZ2VQYXNzd29yZCgpewogICAgICAgICAgICAvL3ZhbGlkYXRlIGN1cnJlbnQgcHcKICAgICAgICAgICAgdmFyIGN1cl9wdyA9IHRoaXMuZm9ybS5jdXJyZW50UGFzc3dvcmQKICAgICAgICAgICAgdmFyIG5ld19wdyA9IHRoaXMuZm9ybS5uZXdQYXNzd29yZAogICAgICAgICAgICB0aGlzLmNoYW5nZVBhc3N3b3JkQXBpQ2FsbChjdXJfcHcsIG5ld19wdykudGhlbigocmVzdWx0KT0+ewogICAgICAgICAgICAgICAgaWYocmVzdWx0KSB7Ly9pZiBzdWNjZWVkZWQKICAgICAgICAgICAgICAgICAgICB0aGlzLnN1Ym1pdFN0YXR1cyA9ICdPSycKICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLiRlbWl0KCdleGl0LWNoYW5nZS1wdy1tb2RlJykKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgICAgICAgIHRoaXMuc3VibWl0U3RhdHVzID0gJ0VSUk9SJwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9KQogICAgICAgICAgICB0aGlzLnN1Ym1pdFN0YXR1cyA9ICdQRU5ESU5HJwogICAgICAgIH0KCgogICAgfQp9Cg=="},{"version":3,"sources":["ChangePasswordForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA","file":"ChangePasswordForm.vue","sourceRoot":"src/components/account","sourcesContent":["<template>\n    <b-card-title class=\"text-center mt-2\" >\n        <div v-if=\"submitStatus === 'OK'\">\n            <b-alert variant=\"success\" show>Changed password successfully</b-alert>\n        </div>\n        <div v-if=\"submitStatus === 'ERROR'\">\n            <b-alert variant=\"danger\" show>Current password is incorrect. Please check again</b-alert>\n        </div>\n        <div v-if=\"submitStatus === 'PENDING'\">\n            <b-alert variant=\"info\" show>Sending request...</b-alert>\n        </div>\n\n        <b-form @submit.prevent=\"updateName\">\n            <b-form-group >\n                <b-form-input\n                    v-model=\"form.currentPassword\"\n                    type=\"password\"\n                    required\n                    placeholder=\"Enter current password\"\n                ></b-form-input>\n            </b-form-group>\n            \n            <b-form-group \n                :invalid-feedback=\"invalidPw\"\n                :state=\"pwState\"\n            >\n                <b-form-input\n                    v-model=\"form.newPassword\"\n                    :state=\"pwState\"\n                    type=\"password\"\n                    required\n                    placeholder=\"Enter new password\"\n                ></b-form-input>\n            </b-form-group>\n            \n            <b-form-group\n                :invalid-feedback=\"invalidCfPw\"\n                :state=\"cfPwState\"  \n            >\n                <b-form-input\n                    v-model=\"form.confirmNewPassword\"\n                    :state=\"cfPwState\"\n                    type=\"password\"\n                    required\n                    placeholder=\"Re-enter new password\"\n                ></b-form-input>\n            </b-form-group>\n            <div>\n              <b-button @click=\"changePassword\" variant=\"outline-success\" class=\"mr-1\">➕</b-button>\n              <b-button @click=\"$emit('exit-change-pw-mode')\" variant=\"outline-danger\">✖️</b-button>\n          </div>\n        </b-form>\n    </b-card-title>\n</template>\n\n<script>\nexport default {\n    data(){\n        return {\n            form: {\n                currentPassword: '',\n                newPassword: '',\n                confirmNewPassword: ''\n            },\n            submitStatus: '',\n            user_db_host: this.$api_hosts['user_db_api'],\n            user_db_port: this.$api_ports['user_db_api']\n        }\n    },\n    computed: {\n        pwState() {\n            if(this.form.newPassword=='') {\n                return null\n            }\n            return this.form.newPassword.length >= 6\n        },\n        cfPwState() {\n            if(this.form.confirmNewPassword=='') {\n                return null\n            }\n            return this.form.confirmNewPassword == this.form.newPassword\n        },\n        invalidPw() {\n            if (this.form.newPassword.length > 0) {\n                return 'Enter at least 6 characters.'\n            }\n            return null\n        },\n        invalidCfPw() {\n            if (this.form.confirmNewPassword.length > 0) {\n                return 'Confirm password need to be same as password'\n            }\n            return null\n        },\n    },\n\n    methods: {\n\n        async changePasswordApiCall(currentPassword, newPassword) {\n            const user_id = this.$session.get('user').id\n            try {\n                const response = await fetch(`http://${this.user_db_host}:${this.user_db_port}/users/${user_id}/change-password`, {\n                method: 'POST',\n                body: JSON.stringify({\n                    'cur_password': currentPassword,\n                    'new_password': newPassword\n                    }),\n                headers: { 'Content-type': 'application/json; charset=UTF-8' },\n                })\n                const result = await response.json()\n                if (result['change-pw-result']=='succeeded') { //sign in successfully\n                    return true\n                }\n                return false\n            } catch (error) {\n                console.error(error)\n            }\n        },\n\n        changePassword(){\n            //validate current pw\n            var cur_pw = this.form.currentPassword\n            var new_pw = this.form.newPassword\n            this.changePasswordApiCall(cur_pw, new_pw).then((result)=>{\n                if(result) {//if succeeded\n                    this.submitStatus = 'OK'\n                    // this.$emit('exit-change-pw-mode')\n                }\n                else {\n                    this.submitStatus = 'ERROR'\n                }\n            })\n            this.submitStatus = 'PENDING'\n        }\n\n\n    }\n}\n</script>"]}]}