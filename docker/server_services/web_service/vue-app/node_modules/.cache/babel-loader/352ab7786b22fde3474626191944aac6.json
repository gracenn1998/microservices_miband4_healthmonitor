{"remainingRequest":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/babel-loader/lib/index.js!/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js??ref--0-0!/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/device/PairDeviceForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/src/components/device/PairDeviceForm.vue","mtime":1608331019855},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/grace/pj/microservices_miband4_healthmonitor/frontend/vue-app/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KaW1wb3J0ICogYXMgbWliYW5kX2Nvbm4gZnJvbSAnQC9hcGlfY2FsbHMvTWliYW5kQ29ubmVjdGlvbi5qcyc7CmltcG9ydCAqIGFzIG1pYmFuZF9kYiBmcm9tICdAL2FwaV9jYWxscy9NaWJhbmREYi5qcyc7CmV4cG9ydCBkZWZhdWx0IHsKICBjb21wdXRlZDogewogICAgbWFjYWRkU3RhdGU6IGZ1bmN0aW9uIG1hY2FkZFN0YXRlKCkgewogICAgICB2YXIgcmVnZXggPSAvXigoW0EtRmEtZjAtOV17Mn1bOl0pezV9W0EtRmEtZjAtOV17Mn1bLF0/KSskL2k7CgogICAgICBpZiAodGhpcy5taWJhbmQubWFjX2FkZHJlc3MgPT0gJycpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlZ2V4LnRlc3QodGhpcy5taWJhbmQubWFjX2FkZHJlc3MpOwogICAgfSwKICAgIGF1dGhrZXlTdGF0ZTogZnVuY3Rpb24gYXV0aGtleVN0YXRlKCkgewogICAgICBpZiAodGhpcy5taWJhbmQuYXV0aF9rZXkgPT0gJycpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXMubWliYW5kLmF1dGhfa2V5Lmxlbmd0aCA9PSAzMjsKICAgIH0sCiAgICBpbnZhbGlkTUFDYWRkOiBmdW5jdGlvbiBpbnZhbGlkTUFDYWRkKCkgewogICAgICBpZiAodGhpcy5taWJhbmQubWFjX2FkZHJlc3MubGVuZ3RoID49IDE3KSB7CiAgICAgICAgcmV0dXJuICdQbGVhc2UgY2hlY2sgeW91ciBmb3JtYXQuIEV4YW1wbGU6IGExOmIyOmMzOmQ0OmU1OmY2JzsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAogICAgaW52YWxpZEF1dGhrZXk6IGZ1bmN0aW9uIGludmFsaWRBdXRoa2V5KCkgewogICAgICBpZiAodGhpcy5taWJhbmQuYXV0aF9rZXkubGVuZ3RoID4gMCkgewogICAgICAgIHJldHVybiAnQXV0aGVudGljIGtleSBsZW5ndGggaXMgMzIuIEV4YW1wbGU6IDhmYTliNDIwNzg2MjdhNjU0ZDIyYmVmZjk4NTY1NWRiJzsKICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgfSwKICBkYXRhOiBmdW5jdGlvbiBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbWliYW5kOiB7CiAgICAgICAgbWFjX2FkZHJlc3M6ICdFMzowNzo3MjoyNjpENDo2QicsCiAgICAgICAgYXV0aF9rZXk6ICcyZjIwYmE0NGZkY2Y1NGNhMGMyYzM3Y2FkMWY4NTQ4NycKICAgICAgfSwKICAgICAgcGFpcmluZ1N0YXR1czogbnVsbAogICAgfTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGFkZEJhbmQ6IGZ1bmN0aW9uIGFkZEJhbmQobWFjX2FkZCwgYXV0aF9rZXkpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vcmVzZXQgZXJyb3IgbXNnCiAgICAgIHRoaXMucGFpcmluZ1N0YXR1cyA9IG51bGw7CiAgICAgIHZhciB1c2VyX2lkID0gJHNlc3Npb24uZ2V0KCd1c2VyJykuaWQ7CgogICAgICBpZiAodGhpcy5tYWNhZGRTdGF0ZSAmJiB0aGlzLmF1dGhrZXlTdGF0ZSkgewogICAgICAgIG1pYmFuZF9jb25uLmNvbm5lY3RBcGlDYWxsKG1hY19hZGQsIGF1dGhfa2V5KS50aGVuKGZ1bmN0aW9uIChiYW5kKSB7CiAgICAgICAgICBpZiAoYmFuZCkgewogICAgICAgICAgICAvL2Nvbm5lY3Qgc3VjY2VlZGVkIC0+IHZhbGlkIGJhbmQgaW5mbyAtPiBzYXZlIGR0YgogICAgICAgICAgICAvL2Fzc2lnbiBiYW5kIGluZm8gdG8gbWliYW5kIHJlZgogICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYmFuZCkgewogICAgICAgICAgICAgIF90aGlzLm1pYmFuZFtrZXldID0gYmFuZFtrZXldOwogICAgICAgICAgICB9IC8vcGFpciBuZXcgYmFuZCB0aGF0IGlzIG5vdCBzYXZlZCBpbiBkdGIgeWV0CgoKICAgICAgICAgICAgbWliYW5kX2RiLmdldEJhbmRCeVNlcmlhbChiYW5kWydzZXJpYWwnXSkudGhlbihmdW5jdGlvbiAoYmFuZCkgewogICAgICAgICAgICAgIGlmICghYmFuZCkgewogICAgICAgICAgICAgICAgLy9ubyBiYW5kIHdpdGggc2FtZSBzZXJpYWwKICAgICAgICAgICAgICAgIG1pYmFuZF9kYi5wYWlyTmV3QmFuZER0YkFwaUNhbGwodXNlcl9pZCwgX3RoaXMubWliYW5kKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgIF90aGlzLiRzZXNzaW9uLnNldCgnbWliYW5kJywgcmVzdWx0KTsgLy9maW5pc2hlZAoKCiAgICAgICAgICAgICAgICAgICAgX3RoaXMucGFpcmluZ1N0YXR1cyA9ICdPSyc7CgogICAgICAgICAgICAgICAgICAgIF90aGlzLiRlbWl0KCd1cGRhdGUtbGlzdC1kaXNwbGF5Jyk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgX3RoaXMucGFpcmluZ1N0YXR1cyA9ICdEVEInOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAvL3RoaXMgYmFuZCBoYXMgYmVlbiB1c2VkICYgYWRkZWQgaW50byBkdGIgYmVmb3JlCiAgICAgICAgICAgICAgICBpZiAoYmFuZC51c2VyX2lkKSB7CiAgICAgICAgICAgICAgICAgIC8vdGhpcyBiYW5kIGlzIGN1cnJlbnRseSBwYWlyZWQgYnkgYW4gdXNlcgogICAgICAgICAgICAgICAgICBfdGhpcy5wYWlyaW5nU3RhdHVzID0gJ1VOQVZBSUxBQkxFJzsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vdGhpcyBiYW5kIGlzIGN1cnJlbnRseSBmcmVlCiAgICAgICAgICAgICAgICAgIG1pYmFuZF9kYi5wYWlyQXZhaWxhYmxlQmFuZER0YkFwaUNhbGwodXNlcl9pZCwgYmFuZCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCkgewogICAgICAgICAgICAgICAgICAgICAgX3RoaXMuJHNlc3Npb24uc2V0KCdtaWJhbmQnLCByZXN1bHQpOyAvL2ZpbmlzaGVkCgoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnBhaXJpbmdTdGF0dXMgPSAnT0snOwoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzLiRlbWl0KCd1cGRhdGUtbGlzdC1kaXNwbGF5Jyk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgX3RoaXMucGFpcmluZ1N0YXR1cyA9ICdEVEInOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBfdGhpcy5wYWlyaW5nU3RhdHVzID0gJ0VSUk9SJzsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgICB0aGlzLnBhaXJpbmdTdGF0dXMgPSAnUEVORElORyc7CiAgICAgIH0KICAgIH0KICB9Cn07"},{"version":3,"sources":["PairDeviceForm.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div>\n    <b-card-title class=\"text-center mt-2\">\n      <div v-if=\"pairingStatus === 'OK'\">\n        <b-alert variant=\"success\" show>Pairing succeeded</b-alert>\n      </div>\n      <div v-if=\"pairingStatus === 'ERROR'\">\n        <b-alert variant=\"danger\" show>Pair failed. Please check data correctness or data format</b-alert>\n      </div>\n      <div v-if=\"pairingStatus === 'PENDING'\">\n        <b-alert variant=\"info\" show>Pairing...</b-alert>\n      </div>\n      <div v-if=\"pairingStatus === 'DTB'\">\n        <b-alert variant=\"info\" show>Adding to database</b-alert>\n      </div>\n      <div v-if=\"pairingStatus === 'UNAVAILABLE'\">\n        <b-alert variant=\"warning\" show>Pair failed. This band is in using condition.<br> \n          If you want to pair, please hard reset the band.</b-alert>\n      </div>\n      \n      <b-skeleton-wrapper :loading=\"pairingStatus === 'PENDING' || pairingStatus === 'DTB'\">\n        <template #loading>\n        <b-card>\n          <b-skeleton width=\"85%\"></b-skeleton>\n          <b-skeleton width=\"55%\"></b-skeleton>\n          <b-skeleton width=\"70%\"></b-skeleton>\n        </b-card>\n      </template>\n      <b-form @submit.prevent=\"addBand\" v-if=\"pairingStatus !== 'OK'\">\n          <b-form-group \n            label=\"MAC address\"\n            :invalid-feedback=\"invalidMACadd\"\n            :state=\"macaddState\"\n          >\n            <b-form-input class=\"w-100 mb-1\"\n              :state=\"macaddState\"\n              v-model=\"miband.mac_address\"\n              required\n              placeholder=\"Example: a1:c2:3d:4e:f5:6a\"\n            ></b-form-input>\n          </b-form-group>\n\n          <b-form-group \n            label=\"Authentic key\"\n            :invalid-feedback=\"invalidAuthkey\"\n            :state=\"authkeyState\"\n          >\n            <b-form-input class=\"w-100 mb-1\"\n              :state=\"authkeyState\"\n              v-model=\"miband.auth_key\"\n              required\n              placeholder=\"Example: 8fa9b42078627a654d22beff985655db\"\n            ></b-form-input>\n          </b-form-group>\n          <div>\n              <b-button @click=\"addBand(miband.mac_address, miband.auth_key)\" variant=\"outline-success\" class=\"mr-1\">➕</b-button>\n              <b-button @click=\"$emit('exit-add-band-mode')\" variant=\"outline-danger\">✖️</b-button>\n          </div>\n      </b-form>\n      </b-skeleton-wrapper>\n    </b-card-title>\n  </div>\n</template>\n\n<script>\nimport * as miband_conn from '@/api_calls/MibandConnection.js'\nimport * as miband_db from '@/api_calls/MibandDb.js'\n\nexport default {\n  computed: {\n    macaddState() {\n      var regex = /^(([A-Fa-f0-9]{2}[:]){5}[A-Fa-f0-9]{2}[,]?)+$/i;\n      \n      if(this.miband.mac_address=='') {\n        return null\n      }\n      return regex.test(this.miband.mac_address)\n    },\n    authkeyState() {\n      if(this.miband.auth_key=='') {\n        return null\n      }\n      return this.miband.auth_key.length == 32\n    },\n    invalidMACadd() {\n      if (this.miband.mac_address.length >= 17) {\n        return  'Please check your format. Example: a1:b2:c3:d4:e5:f6'\n      }\n      return null\n    },\n    invalidAuthkey() {\n      if (this.miband.auth_key.length > 0) {\n        return  'Authentic key length is 32. Example: 8fa9b42078627a654d22beff985655db'\n      }\n      return null\n    },\n  },\n  data() {\n    return {\n      miband: {\n          mac_address: 'E3:07:72:26:D4:6B',\n          auth_key: '2f20ba44fdcf54ca0c2c37cad1f85487'\n      },\n      pairingStatus: null,\n    }\n  },\n  methods: {\n\n    \n    \n\n    addBand(mac_add, auth_key) {\n      //reset error msg\n      this.pairingStatus = null\n\n      const user_id = $session.get('user').id \n\n      if(this.macaddState && this.authkeyState) {\n        miband_conn.connectApiCall(mac_add, auth_key).then((band)=>{\n          if(band) { //connect succeeded -> valid band info -> save dtb\n            //assign band info to miband ref\n            for(var key in band) {\n              this.miband[key] = band[key]\n            }\n\n            //pair new band that is not saved in dtb yet\n            miband_db.getBandBySerial(band['serial']).then((band)=>{\n              if(!band) { //no band with same serial\n                miband_db.pairNewBandDtbApiCall(user_id, this.miband).then((result)=>{\n                  if(result) {\n                    this.$session.set('miband', result)\n                    //finished\n                    this.pairingStatus = 'OK'\n                    this.$emit('update-list-display')\n                  }\n                })\n                this.pairingStatus = 'DTB'\n              }\n              else { //this band has been used & added into dtb before\n                if(band.user_id) { //this band is currently paired by an user\n                  this.pairingStatus = 'UNAVAILABLE'\n                }\n                else { //this band is currently free\n                  miband_db.pairAvailableBandDtbApiCall(user_id, band).then((result)=>{\n                    if(result) {\n                      this.$session.set('miband', result)\n                      //finished\n                      this.pairingStatus = 'OK'\n                      this.$emit('update-list-display')\n                    }\n                  })\n                  this.pairingStatus = 'DTB'\n                }\n                \n              }\n            })\n          }\n          else {\n            this.pairingStatus = 'ERROR'\n          }\n      \n        })\n        \n        this.pairingStatus = 'PENDING'\n      }\n      \n    }\n  }\n}\n</script>"],"sourceRoot":"src/components/device"}]}